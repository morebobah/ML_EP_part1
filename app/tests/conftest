import pytest
from sqlalchemy import create_engine
from sqlalchemy.orm import DeclarativeBase
from sqlalchemy.orm import sessionmaker, Session
from sqlalchemy.pool import StaticPool 
from models.user import User, Base  

@pytest.fixture(name="session")  
def engine():
    return create_engine("sqlite:///:memory:") # Используем SQLite в памяти для тестов


@pytest.fixture(name="engine")
def session(engine):
    # Создаем таблицы и сессию для тестов
    Base.metadata.create_all(engine)
    with Session(engine) as session:
        yield session
    Base.metadata.drop_all(engine)